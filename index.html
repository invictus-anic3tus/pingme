<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>PingMe</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
</head>


<style>
    :root {
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        --primary-color: white;
        --secondary-color: #e6be74;
        --hover-color: #865b09;
        --hover-color: #fdfdfd;
        --font-color: black;
    }

    h1,
    h2,
    h3,
    h4,
    p,
    div,
    span,
    label {
        color: var(--font-color);
    }

    body {
        margin: 0;
        background-color: var(--primary-color);
        transition-duration: 0.3s;
    }



    /**************** Sidebar ***************/

    #sidebar-main {
        display: flex;
        height: fit-content;
    }

    #sidebar {
        background-color: var(--secondary-color);
        transition-duration: 0.3s;

        padding: 5px;
        padding-bottom: 0;
        padding-top: 0;
        margin-bottom: 0;
        border-right: 2px solid var(--font-color);

        height: fit-content;
        min-height: 100vh;

        width: 200px;
    }

    #tabs {
        display: flex;
        flex-direction: column;
        height: 89vh;
        min-height: fit-content;
        justify-content: flex-start;
    }

    .tab {
        height: auto;
        margin: 5px;
        margin-bottom: 5%;
        transform: scale(1);
        transition-duration: 0.3s;
        background-color: transparent;
        border-radius: 12px;
        padding: 10%;
        padding-right: 5px;
        padding-left: 5px;
    }

    .tab:hover {
        background-color: var(--hover-color);
        transition-duration: 0.5s;
        cursor: pointer;
    }

    .tab a {
        text-decoration: none;
        height: 100%;
        display: flex;
        align-items: center;
    }

    .tab img {
        padding-right: 10px;
        transition-duration: 0.3s;
    }

    .tab span {
        margin: auto;
        color: var(--font-color);
        font-size: 1.5em;

        text-wrap: nowrap;
    }


    #collapse {
        width: fit-content;
        padding-top: 0;
        padding-bottom: 0;
        margin-bottom: 10%;
        align-self: flex-end;
    }


    .divider {
        height: 2px;
        width: 90%;
        background-color: var(--font-color);
        margin: 5%;
    }

    #sidebar-header {
        display: flex;
        text-align: center;
        align-items: center;
        margin: 10px;
        margin-top: 20px;
        margin-bottom: 35px;
    }

    #sidebar-header img {
        width: 50px;
        height: auto;
    }

    #sidebar-header span {
        margin-left: 5%;
        font-size: 2em;
        font-weight: 400;
        color: var(--font-color);
    }

    #mini-tabs {
        display: flex;
        margin-top: auto;
    }

    #mini-tabs img {
        width: 90%;
        padding: 0%;
        transition-duration: 0.3s;
    }

    #mini-tabs a {
        width: fit-content;
    }

    #light-dark,
    #mini-tabs div {
        width: fit-content;
        height: fit-content;
        padding: 0;
        margin: 10px;
    }

    #light-dark img {
        padding: 0%;
    }

    #light-dark:hover,
    #mini-tabs div:hover {
        background-color: transparent;
        cursor: pointer;
    }

    #about {
        position: relative;
    }

    #about-info {
        position: absolute;
        margin-left: -80px !important;
        margin-top: -70px !important;
        width: 170px !important;
        height: 20px !important;
        text-align: center;
        background-color: var(--primary-color);
        border: 2px solid var(--font-color);
        border-radius: 10px;
        padding: 10px !important;
        color: var(--font-color);

        scale: 0;
        transition-duration: 0.2s;
    }

    #about-info:hover {
        background-color: var(--hover-color) !important;
    }



    /************** Main Block *************/


    #main {
        width: 100vw;
    }

    .main-tab {
        display: none;
        width: 100%;
    }

    #home-tab {
        display: block;
    }

    .main-header {
        font-size: 3em;
        padding: 20px;
        margin-top: 0;
        width: fit-content;
        border-bottom: 7px double var(--font-color);
        border-right: 7px double var(--font-color);
        border-bottom-right-radius: 20px;
    }

    #pings-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        grid-template-rows: repeat(auto-fit, minmax(200px, 1fr));
    }

    .ping {
        grid-row: auto;
        border: 2px solid var(--font-color);
        border-radius: 10px;
        margin: 10px;
        padding: 10px;

        display: block;

        background-color: var(--secondary-color);
    }

    .title-ping-flex {
        display: flex;
        justify-content: space-between;
    }

    .ping-title {
        align-self: center;
        font-size: 1.5em;
        background-color: transparent;
        border: 0;
        color: var(--font-color);
        width: fit-content;
        cursor: default;
        border-bottom: 2px solid var(--font-color);

        text-overflow: ellipsis;
    }

    .ping-title:focus {
        outline: none;
    }

    .options {
        height: 35px;
        padding-top: -5px;
        align-self: center;
        width: auto;
        cursor: pointer;
    }

    .edit {
        height: 30px;
        width: auto;
        align-self: center;
        cursor: pointer;
    }

    .dot-options {
        text-align: left;
        align-self: flex-end;
        position: absolute;
        margin-left: 10%;
        scale: 1;

        padding: 5px;
        transition-duration: 0.3s;
        background-color: var(--secondary-color);
        border: 2px solid black;
        border-radius: 10px;
    }

    .dot-options button {
        padding: 2px;
        padding-right: 0;
        padding-left: 0;
        margin: 0;
        background-color: transparent;
        border: 0;
        color: var(--font-color);
        display: block;
        font-size: 1em;
        letter-spacing: 0.9px;
    }


    .ping-desc {
        resize: none;
        font-size: 1.1em;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        background-color: transparent;
        border: 0;
        color: var(--font-color);
        width: 100%;

        margin-top: 10px;
        cursor: default;
        outline: 0;
    }

    .repeat-num {
        display: none;
        width: 35px;
    }

    .does-repeat-label,
    .does-repeat {
        display: none;
    }

    .ping-date {
        border: 1px solid var(--font-color);
        width: fit-content;
        padding: 2px;
        padding-left: 3px;
        padding-right: 3px;
        border-radius: 5px;
        background-color: var(--primary-color);
    }

    .ping-functions {
        display: flex;
        justify-content: space-evenly;
        height: 25px;
        margin-top: 5px;
    }

    .ping-functions button {
        width: 100%;
        height: 100%;
        color: var(--font-color);
    }

    .ping-functions button:active {
        background-color: var(--hover-color);
    }

    .complete-yes {
        border: 1px solid var(--font-color);
        border-left: 2px solid var(--font-color);
        border-top: 2px solid var(--font-color);
        border-bottom: 2px solid var(--font-color);
        border-radius: 10px 0px 0px 10px;
        background-color: rgb(17, 204, 17);

        width: 50%;
        color: var(--font-color);
    }

    .ping-delay {
        border: 0;
        border-top: 2px solid var(--font-color);
        border-bottom: 2px solid var(--font-color);
        background-color: rgb(31, 167, 190);
    }

    .delete-no {
        border: 1px solid var(--font-color);
        border-right: 2px solid var(--font-color);
        border-top: 2px solid var(--font-color);
        border-bottom: 2px solid var(--font-color);
        border-radius: 0px 10px 10px 0px;
        background-color: rgb(255, 74, 74);

        width: 50%;
        color: var(--font-color);
    }


    #full-pop-up {
        position: absolute;
        left: 50%;
        top: 50%;

        transform: translate(-25%, -50%);

        border: 2px solid var(--font-color);
        background-color: var(--primary-color);
        border-radius: 20px;
        padding: 10px;
        scale: 0;
        transition-duration: 0.3s;
    }

    #full-pop-up div {
        display: flex;
    }

    /***************** Media Queries ***************/
    @media (max-width: 600px) {
        #sidebar-main {
            display: block;
            width: 100vw;
        }

        #sidebar {
            height: 10px !important;
            min-height: fit-content;
            width: 100vw !important;
            margin: 0;
            padding: 0;
            padding-top: 10px;
            border: 0;
            border-top: 2px solid;
            position: absolute;
            bottom: 0;
        }

        #tabs {
            display: flex;
            flex-direction: row;
            height: fit-content;
            justify-content: space-evenly;
            margin: 0;
            padding: 0;
        }

        .tab {
            padding: 0;
        }

        .tab span,
        .divider,
        #mini-tabs,
        #light-dark,
        #sidebar-header,
        #collapse {
            display: none !important;
        }

        .tab img {
            padding: 10px !important;
        }



        #pings-container {
            display: block !important;
        }
    }
</style>

<body>

    <div id="sidebar-main">
        <div id="sidebar">
            <div id="sidebar-header">
                <img src="images/PingMe.png">
                <span style="display: inline;">PingMe</span>
            </div>
            <div id="tabs">
                <div class="tab" id="collapse">
                    <a onclick="collapse()" style="width: fit-content;">
                        <img src="/images/hide_sidebar.png" alt="Collapse Sidebar" class="icon" style="padding: 0;"
                            id="collapse-ind">
                    </a>
                </div>

                <div class="divider"></div>

                <div class="tab" id="home">
                    <a onclick="tab('home')">
                        <img src="/images/Home.png" alt="Home" class="icon">
                        <span>Home</span></a>
                </div>
                <div class="tab" id="my-pings">
                    <a onclick="tab('my-pings')">
                        <img src="/images/Pings.png" alt="My pings" class="icon">
                        <span>All pings</span></a>
                </div>
                <div class="tab" id="new">
                    <a onclick="tab('new')">
                        <img src="/images/Plus.png" alt="New ping" class="icon">
                        <span>Add ping</span></a>
                </div>


                <div class="divider"></div>


                <div class="tab" id="settings">
                    <a onclick="tab('settings')">
                        <img src="/images/Settings.png" alt="Settings" class="icon">
                        <span>Settings</span></a>
                </div>

                <div class="tab" id="light-dark" onclick="colorMode()">
                    <img src="/images/dark_mode.png" alt="Dark/Light mode" id="modeind">
                </div>

                <div id="mini-tabs">
                    <div class="tab" id="github">
                        <a href="https://github.com/invictus-anic3tus/pingme"><img src="/images/github.svg" alt="GitHub"
                                class="icon"></a>
                    </div>
                    <div class="tab" id="about">
                        <a href="https://invictus-anic3tus.github.io/">
                            <div id="about-info">About the Creator</div><img src="/images/question_mark.png"
                                alt="About the Creator" class="icon" style="margin-top: 7px;">
                        </a>
                    </div>
                </div>

            </div>
        </div>
        <div id="main">
            <div id="home-tab" class="main-tab">
                <h1 class="main-header">Home</h1>

                <div id="home-tab-pings">

                    <h1 style="text-align: center;">Upcoming Pings:</h1>

                    <div id="pings-container">
                        <div class="ping" id="0" style="display: block;">
                            <div class="title-ping-flex">
                                <input type="text" value="Welcome to PingMe!" class="ping-title" readonly
                                    spellcheck="false"></input>


                                <img src="/images/Edit.png" alt="Edit Ping" class="icon edit" onclick="editPing(this)">

                                <!-- <img src="/images/vert_ellipsis.png" alt="Options" class="icon options" onclick="optionPopUp(0)"> -->
                                <!-- <div class="dot-options">
                                    <button onclick="complete(this)">Complete</button>
                                    <button>Delay</button>
                                    <button>Edit</button>
                                    <button>Delete</button>
                                </div> -->
                            </div>

                            <p>Pings <span class="ping-date">Jan 1, 2023, 12:01 AM</span></p>

                            <textarea name="ping-desc" class="ping-desc" readonly
                                spellcheck="false">Yo! I'm your description. Edit this ping with the button at the top right.</textarea>

                            <label class="does-repeat-label">Repeat?</label>
                            <input type="checkbox" name="does-repeat" class="does-repeat">

                            <div class="repeat-cont">Repeats every <span class="repeat-num-display">10</span>
                                <input type="number" inputmode="numeric" class="repeat-num"><select name="repeat-type"
                                    class="repeat-type" style="display: none;">
                                    <option value="hours">hours</option>
                                    <option value="days">days</option>
                                    <option value="weeks">weeks</option>
                                    <option value="months">months</option>
                                    <option value="years">years</option>
                                </select><span class="repeat-type-display">hours</span>
                            </div>

                            <div class="ping-functions">
                                <button class="complete-yes" onclick="completePing(this, false)">Complete</button>
                                <button class="ping-delay" onclick="delayPing(this, false)">Delay</button>
                                <button class="delete-no" onclick="deletePing(this, false)">Delete</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div id="pings-tab" class="main-tab">
                <h1 class="main-header">All Pings</h1>

                <div id="all-pings">

                </div>

            </div>

            <div id="add-ping-tab" class="main-tab">
                <h1 class="main-header">Add Ping</h1>

                <div id="add-interface">

                </div>

            </div>

            <div id="settings-tab" class="main-tab">
                <h1 class="main-header">Settings</h1>

                <div id="settings-interface">

                </div>

            </div>

            <div id="full-pop-up">
                <h1>Pop up title</h1>
                <p>Pop up information.</p>
                <div>
                    <button class="complete-yes">Go
                        back</button>
                    <button class="delete-no">delete</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const root = document.querySelector(':root');
        const body = document.querySelector('body');
        const sidebar = document.getElementById('sidebar');
        const sidebarHeader = document.getElementById('sidebar-header');
        const modeInd = document.getElementById('modeind');
        const icons = document.querySelectorAll('.icon');
        const collapseBut = document.getElementById('collapse');
        const collapseInd = document.getElementById('collapse-ind');
        const tabs = document.querySelectorAll('.tab');
        const miniTabs = document.getElementById('mini-tabs');
        const about = document.getElementById('about');
        const aboutpopup = document.getElementById('about-info');

        const homeTab = document.getElementById('home-tab');
        const pingsTab = document.getElementById('pings-tab');
        const newTab = document.getElementById('add-ping-tab');
        const settingsTab = document.getElementById('settings-tab');

        const pings = document.querySelectorAll('.ping');


        const editIcon = document.querySelectorAll('.edit');

        const options = document.querySelectorAll('.options');
        const optionsPopUp = document.querySelectorAll('.dot-options');

        const popup = document.getElementById('full-pop-up');

        var darkS = localStorage.getItem('dark');
        var dark = (darkS === 'true');

        var darkBKG = '#222831';
        var lightBKG = '#FFFFFF';
        var lightSecondary = '#e6be74';
        var darkSecondary = '#3A4750';
        var fontColor = '#000000';

        var collapsed = false;
        var pingToAlter;

        // Code to execute at beginning:
        tabs.forEach(element => {
            element.style.backgroundColor = 'transparent';
            if (element.id == 'home') {
                element.style.backgroundColor = getComputedStyle(root).getPropertyValue('--hover-color');
            }
        });

        body.style.transitionDuration = '0s';
        sidebar.style.transitionDuration = '0s';

        icons.forEach(icon => {
            icon.style.transitionDuration = '0s';
        });
        optionsPopUp.forEach(popup => {
            popup.style.transitionDuration = '0s';
        });

        if (dark == true) {
            setDark();
        }
        else {
            setLight();
        }
        body.style.transitionDuration = '0.3s';
        sidebar.style.transitionDuration = '0.3s';

        icons.forEach(icon => {
            icon.style.transitionDuration = '0.3s';
        });
        optionsPopUp.forEach(popup => {
            popup.style.transitionDuration = '0.3s';
        });

        about.addEventListener('mouseover', (event) => {
            aboutpopup.style.scale = '1';
        });
        about.addEventListener('mouseout', (event) => {
            aboutpopup.style.scale = '0';
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(registration => {
                console.log('Service Worker registered with scope:', registration.scope);
            }).catch(error => {
                console.error('Service worker error:', error);
            });
        }


        pings.forEach(ping => { setupPing(ping); checkPingDate(ping); });




        // Functions:

        function notification(body, actions) {

            if ('serviceWorker' in navigator && 'Notification' in window) {
                Notification.requestPermission().then(permission => {


                    if (permission === "granted") {

                        navigator.serviceWorker.getRegistration().then(registration => {
                            if (registration) {
                                if (actions) {
                                    registration.showNotification("Hello! Notifications are enabled.", {
                                        body: body,
                                        icon: "/images/PingMe.png",
                                        actions: actions
                                    });
                                }
                                else {
                                    registration.showNotification("Hello! Notifications are enabled.", {
                                        body: body,
                                        icon: "/images/PingMe.png"
                                    });
                                }
                            }
                        });

                    } else {

                        alert('Hey! For this to work you kinda need to enable notifications.');
                    }
                });
            }
        }

        function addTimeToPing(ping, time) {
            let dateDisplay = ping.querySelector('.ping-date');
            let dateStr = dateDisplay.innerText;
            let date = new Date(dateStr);

            let newDate = addTimeToDate(date, time);

            let dateOptions = {
                year: 'numeric', month: 'short', day: 'numeric',
                hour: 'numeric', minute: 'numeric'
            }

            formatDate = newDate.toLocaleString('en-US', dateOptions);
            dateDisplay.innerText = formatDate;

            localStorage.setItem(ping.id + '-next-ping', formatDate);
        }

        function completePing(obj, final) {
            if (final) {
                let doesRepeat = pingToAlter.querySelector('.does-repeat').checked;

                if (doesRepeat) {
                    let addAmount = pingToAlter.querySelector('.repeat-num').value + " " + pingToAlter.querySelector('.repeat-type').value;
                    addTimeToPing(pingToAlter, addAmount);
                }

                popup.style.scale = '0';
            }
            else {
                bodyPopUp('Complete ping??', "Reminder: If you're completing this early, this ping will ping again the the amount of time you specified after the DUE DATE, not today.", 'Yeah!', 'never mind', 'completePing(null, true)', 'this.parentElement.parentElement.style.scale = "0";');
                pingToAlter = obj.parentElement.parentElement;
            }
        }

        function delayPing(obj, final, amount) {
            if (final) {
                if (popup.querySelector('.delay-num').value < 1) {
                    alert('Please delay a positive value :)');
                    return;
                }
                addTimeToPing(pingToAlter, amount);
                popup.style.scale = '0';
                checkPingDate(pingToAlter);
            }
            else {

                let header = 'Delay Ping ' + obj.parentElement.parentElement.querySelector('.ping-title').innerText;
                let content = `<input type="number" class="delay-num" value="1" min="1">
<select name="repeat-type" class="delay-type">
<option value="hours">hours</option>
<option value="days">days</option>
<option value="weeks">weeks</option>
<option value="months">months</option>
<option value="years">years</option>
</select>`;

                let delayFunc = 'delayPing(null, true, document.getElementById("full-pop-up").querySelector("p").querySelector(".delay-num").value + document.getElementById("full-pop-up").querySelector("p").querySelector(".delay-type").value)';
                bodyPopUp(header, content, 'Delay', 'Cancel', delayFunc, 'this.parentElement.parentElement.style.scale = "0";');
                pingToAlter = obj.parentElement.parentElement;
            }
        }

        function deletePing(obj, final) {
            if (final) {
                pingToAlter.style.display = 'none';
                localStorage.setItem(pingToAlter.id + '-deleted', 'true');
                popup.style.scale = '0';
            }
            else {
                let header = 'Are you sure you want to delete ping ' + obj.parentElement.parentElement.querySelector('.ping-title').value + '?';
                let content = 'All deletions are final!';
                let act1 = 'this.parentElement.parentElement.style.scale = "0"';
                let act2 = 'deletePing(null, true)';

                bodyPopUp(header, content, 'go back', 'delete', act1, act2);

                pingToAlter = obj.parentElement.parentElement;
            }
        }

        function addTimeToDate(date, addedTime) {
            const timeUnits = {
                seconds: 1000,
                minutes: 60 * 1000,
                hours: 60 * 60 * 1000,
                days: 24 * 60 * 60 * 1000,
                weeks: 7 * 24 * 60 * 60 * 1000,
                months: 30 * 24 * 60 * 60 * 1000, // 30 day months
                years: 365 * 24 * 60 * 60 * 1000 // 365 day years
            };

            const regex = /^(\d+)\s*(\w+)$/; // Match a number followed by a unit
            const match = addedTime.match(regex);

            const amount = parseInt(match[1], 10); // number
            const unit = match[2].toLowerCase();//days,months, weeks ,years, etc.

            if (!timeUnits[unit]) {
                throw new Error(`Unsupported time unit: ${unit}`);
            }

            // Calculate the new timestamp for adding to the orig
            const addedMilliseconds = amount * timeUnits[unit];
            const newDate = new Date(date.getTime() + addedMilliseconds);

            return newDate;
        }

        function bodyPopUp(header, content, button1, button2, button1act, button2act) {
            let leftButton = popup.querySelector('.complete-yes');
            let rightButton = popup.querySelector('.delete-no');

            popup.querySelector("h1").innerText = header;
            popup.querySelector("p").innerHTML = content;
            leftButton.innerText = button1;
            rightButton.innerText = button2;

            leftButton.setAttribute('onclick', button1act);
            rightButton.setAttribute('onclick', button2act);

            popup.style.scale = '1';
        }

        function checkPingDate(obj) {
            let dateStr = obj.querySelector('.ping-date').innerText;
            let date = new Date(dateStr);

            if (isPingNow(date)) {
                let actions = [
                    { action: 'complete', title: 'Complete!' },
                    { action: 'delay', title: 'Delay for a day' }
                ];
                let message = "Ping: '" + obj.querySelector('.ping-title').value + "' has pinged!"
                notification(message, actions);


            }
        }

        function isPingNow(date) {
            const today = new Date();

            return date < today;
        }

        function fillEmptyText(obj) {
            let title = obj.querySelector('.ping-title');
            let desc = obj.querySelector('.ping-desc');

            if (title.value.trim() == '') {
                title.value = 'My Ping';
            }
            if (desc.value.trim() == '') {
                desc.value = 'Optional description about my ping';
            }
        }

        function setupPing(obj) {
            if (obj.style.display == 'none' || localStorage.getItem(obj.id + '-deleted') == 'true') {
                obj.style.display = 'none';
                return;
            }

            let title = obj.querySelector('.ping-title');
            let nextPing = obj.querySelector('.ping-date');
            let desc = obj.querySelector('.ping-desc');
            let repeatNumDisplay = obj.querySelector('.repeat-num-display');
            let repeatNum = obj.querySelector('.repeat-num');
            let repeatType = obj.querySelector('.repeat-type');
            let repeatTypeDisplay = obj.querySelector('.repeat-type-display');
            let doesRepeat = obj.querySelector('.does-repeat');

            if (localStorage.getItem(obj.id + '-title') && localStorage.getItem(obj.id + '-desc')) {
                title.value = localStorage.getItem(obj.id + '-title');
                desc.value = localStorage.getItem(obj.id + '-desc');
            }
            if (!localStorage.getItem(obj.id + '-next-ping')) {
                localStorage.setItem(obj.id + '-next-ping', nextPing.innerText);
            }
            nextPing.innerText = localStorage.getItem(obj.id + '-next-ping');

            fillEmptyText(obj);

            doesRepeat.checked = localStorage.getItem(obj.id + '-does-repeat') == 'true';

            if (doesRepeat.checked == true) {
                repeatNumDisplay.innerText = localStorage.getItem(obj.id + '-repeat-num');
                repeatNum.value = repeatNumDisplay.innerText;

                repeatTypeDisplay.innerText = localStorage.getItem(obj.id + '-repeat-type');
                repeatType.value = repeatTypeDisplay.innerText;
            }
            else {
                obj.querySelector('.repeat-cont').style.display = 'none';
            }
        }


        function editPing(obj) {
            let grampsDiv = obj.parentElement.parentElement;
            let title = obj.parentElement.querySelector('.ping-title');
            let desc = grampsDiv.querySelector('.ping-desc');
            let date = grampsDiv.querySelector('.ping-date');

            let repeatCont = grampsDiv.querySelector('.repeat-cont');
            let repeatNum = grampsDiv.querySelector('.repeat-num');
            let repeatType = grampsDiv.querySelector('.repeat-type');
            let repeatTypeDisplay = grampsDiv.querySelector('.repeat-type-display');
            let doesRepeat = grampsDiv.querySelector('.does-repeat');

            title.style.border = '2px solid gray';
            title.style.borderRadius = '5px';
            title.removeAttribute('readonly');
            title.style.cursor = 'text';
            title.style.backgroundColor = 'white';
            title.style.color = 'black';
            title.setAttribute('spellcheck', 'true');

            desc.style.border = '2px solid gray';
            desc.style.borderRadius = '5px';
            desc.removeAttribute('readonly');
            desc.style.cursor = 'text';
            desc.style.backgroundColor = 'white';
            desc.style.color = 'black';
            desc.setAttribute('spellcheck', 'true');

            grampsDiv.querySelector('.does-repeat-label').style.display = 'inline';
            doesRepeat.style.display = 'inline';

            repeatCont.style.display = 'block';
            repeatType.style.display = 'inline';
            repeatTypeDisplay.style.display = 'none';

            repeatNum.style.display = 'inline';
            grampsDiv.querySelector('.repeat-num-display').style.display = 'none';

            obj.src = '/images/Check.png';
            obj.style.marginTop = '1px';
            obj.setAttribute('onclick', 'finishEditPing(this)');
        }

        function finishEditPing(obj) {
            let parentDiv = obj.parentElement;
            let grampsDiv = parentDiv.parentElement;
            let title = parentDiv.querySelector('.ping-title');
            let desc = grampsDiv.querySelector('.ping-desc');

            let repeatCont = grampsDiv.querySelector('.repeat-cont');
            let repeatNum = grampsDiv.querySelector('.repeat-num');
            let repeatNumDisplay = grampsDiv.querySelector('.repeat-num-display');
            let repeatType = grampsDiv.querySelector('.repeat-type');
            let repeatTypeDisplay = grampsDiv.querySelector('.repeat-type-display');
            let doesRepeat = grampsDiv.querySelector('.does-repeat');
            let doesRepeatVal = doesRepeat.checked;

            title.style.border = '0';
            title.style.borderBottom = '2px solid var(--font-color)';
            title.style.borderRadius = '0';
            title.setAttribute('readonly', '');
            title.style.cursor = 'default';
            title.style.backgroundColor = 'transparent';
            title.style.color = 'var(--font-color)';
            title.setAttribute('spellcheck', 'false');

            desc.style.border = '0';
            desc.style.borderRadius = '0';
            desc.setAttribute('readonly', '');
            desc.style.cursor = 'default';
            desc.style.backgroundColor = 'transparent';
            desc.style.color = 'var(--font-color)';
            desc.setAttribute('spellcheck', 'false');

            if (repeatNum.value.trim() == '') {
                repeatNum.value = 0;
            }


            if (doesRepeatVal) {
                repeatNumDisplay.innerText = repeatNum.value;
                repeatNum.style.display = 'none';
                repeatNumDisplay.style.display = 'inline';

                repeatTypeDisplay.innerText = repeatType.value;
                repeatType.style.display = 'none';
                repeatTypeDisplay.style.display = 'inline';
            }
            else {
                repeatCont.style.display = 'none';
            }
            doesRepeat.style.display = 'none';
            grampsDiv.querySelector('.does-repeat-label').style.display = 'none';


            fillEmptyText(grampsDiv);


            localStorage.setItem(grampsDiv.id + '-title', title.value);
            localStorage.setItem(grampsDiv.id + '-desc', desc.value);

            localStorage.setItem(grampsDiv.id + '-does-repeat', doesRepeatVal);
            localStorage.setItem(grampsDiv.id + '-repeat-num', repeatNum.value);
            localStorage.setItem(grampsDiv.id + '-repeat-type', repeatType.value);

            obj.src = '/images/Edit.png';
            obj.style.marginTop = 'initial';
            obj.setAttribute('onclick', 'editPing(this)');
        }

        function optionPopUp(num) {
            optionsPopUp[num].style.scale = '1';
        }

        function collapse() {

            if (!collapsed) {

                tabs.forEach(tab => {

                    let span = tab.querySelector('span');
                    let img = tab.querySelector('img');

                    if (span) {
                        span.style.display = 'none';
                        tab.style.width = 'fit-content';
                    }
                    if (img) {
                        img.style.paddingRight = '0';
                    }

                    tab.style.marginBottom = '20%';

                });

                sidebarHeader.querySelector('span').style.display = 'none';
                sidebar.style.width = 'fit-content';
                collapseInd.src = '/images/show_sidebar.png';
                collapseBut.style.alignSelf = 'flex-start';

                miniTabs.querySelector('#about').style.display = 'none';

                collapsed = true;
            }
            else {


                tabs.forEach(tab => {

                    let span = tab.querySelector('span');
                    let img = tab.querySelector('img');

                    if (span) {
                        span.style.display = 'inline';
                        tab.style.width = 'auto';
                    }
                    if (img) {
                        img.style.paddingRight = '10px';
                    }

                    tab.style.marginBottom = 'initial';

                });

                sidebarHeader.querySelector('span').style.display = 'inline';
                sidebar.style.width = '200px';
                collapseInd.src = '/images/hide_sidebar.png';
                collapseBut.style.alignSelf = 'flex-end';

                miniTabs.querySelector('#about').style.display = 'block';

                collapsed = false;
            }
        }

        function tab(tab) {
            tabs.forEach(element => {
                element.style.backgroundColor = 'transparent';
            });
            var tabobj = document.getElementById(tab);
            tabobj.style.backgroundColor = getComputedStyle(root).getPropertyValue('--hover-color');

            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.style.display = 'none';
            });

            switch (tab) {
                case 'home': // home-tab, pings-tab, add-ping-tab, settings-tab
                    document.getElementById('home-tab').style.display = 'block';
                    break;
                case 'my-pings':
                    document.getElementById('pings-tab').style.display = 'block';
                    break;
                case 'new':
                    document.getElementById('add-ping-tab').style.display = 'block';
                    break;
                case 'settings':
                    document.getElementById('settings-tab').style.display = 'block';
                    break;
                default:
                    break;
            }
        }

        function colorMode() {
            if (dark) {
                setLight();
                dark = false;
            }
            else {
                setDark();
                dark = true;
            }
            localStorage.setItem('dark', dark);
        }

        function setDark() {
            fontColor = '#FFFFFF';
            root.style.setProperty('--primary-color', darkBKG);
            root.style.setProperty('--hover-color', '#888888');
            root.style.setProperty('--secondary-color', darkSecondary);
            root.style.setProperty('--font-color', fontColor);

            modeInd.src = '/images/light_mode.png';

            icons.forEach(icon => {
                icon.style.filter = 'invert(100%)';
            });
            resetSelector();

        }
        function setLight() {
            fontColor = '#000000';
            root.style.setProperty('--primary-color', lightBKG);
            root.style.setProperty('--hover-color', '#fdfdfd');
            root.style.setProperty('--secondary-color', lightSecondary);
            root.style.setProperty('--font-color', fontColor);

            modeInd.src = '/images/dark_mode.png';

            icons.forEach(icon => {
                icon.style.filter = 'invert(0)';
            });
            resetSelector();

        }

        function resetSelector() {
            document.querySelectorAll('.tab').forEach(element => {
                if (element.style.backgroundColor != 'transparent') {
                    element.style.backgroundColor = getComputedStyle(root).getPropertyValue('--hover-color');
                }
                else { element.style.backgroundColor = 'transparent'; }
            });
        }
    </script>
</body>

</html>